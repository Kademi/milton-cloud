<html>    <head>        <title>Profile</title>        <link href="profile.css" rel="stylesheet" type="text/css" />    </head>    <body class="profile">        <div class="bar">            <h3>My Profile</h3>            <div class="clr"></div>        </div>        <div class="details">            <form action="." method="POST" enctype="multipart/form-data" class="profile">                <h4>Update your details</h4>                <p class="pageMessage"></p>                <fieldset class="name">                    <legend>Please update your details below then click the 'Save' button.</legend>                    <div class="input">                        <label for="nickName">Nickname</label>                        <input type="text" name="nickName" id="nickName" class="required" value="$!page.profile.nickName"/>                        <label for="nickName">Email</label>                        <input type="text" id="email" name="email" class="required" value="$!page.profile.email" />                                                <label for="nickName">First name</label>                        <input type="text" id="firstName" name="firstName" value="$!page.profile.firstName" />                        <label for="nickName">Surname</label>                        <input type="text" id="surName" name="surName" value="$!page.profile.surName" />                        <label for="nickName">Phone</label>                        <input type="text" id="phone" name="phone" value="$!page.profile.phone" />                        #foreach($fieldAndValue in $page.extraFields.entrySet())                        #set($field = $fieldAndValue.key)                        #set($value = $fieldAndValue.value)                        <label for="field_${field.name}">$field.text</label>                        $field.html( $value )                        #end                    </div>                    <button class="Btn">Save</button>                </fieldset>            </form>                    </div>        <div class="profilePic">            <p class="confirm">Your profile photo has been updated</p>            <div>                <img src="$page.photoHref" /><h4>Update photo</h4>                <p>Update your profile image below. This must be less then 10Mb</p>            </div>            <div class="input" id='myUploaded'></div>        </div>        <div class='changeOrg'>            <form action="." method="POST" class="form-inline memberships">                <img class='ajax-loader' src='/static/common/loading.gif'/>                <h4>Memberships</h4>                #if( $page.memberships.isEmpty() )                <p>You have no memberships in this website, so most functions will be unavailable. <a href="/contactus">Please contact an administrator</a> to regain access.</p>                #else                <ul class='memberships'>                    #foreach($membership in $page.memberships)                    <li>                        Member of the <b>$membership.groupEntity.name</b> group in                         #if( $membership.groupEntity.openGroup )                        <a href="?changeMemberOrg=${membership.id} .content form" data-toggle="modal" data-target="#changeOrgModal">$membership.withinOrg.formattedName (change)</a>                        #else                        <b>$membership.withinOrg.formattedName</b>                        #end                    <acronym title='Remove this membership. If this is your last membership you will lose access to this site'>                        <a href='$membership.id' class='membership-remove'><i class="icon-remove-circle"></i><span>Remove</span></a>                    </acronym>                    </li>                    #end                </ul>                #end            </form>        </div>                <div style="clear: both"></div>        <div class="changePassword">                        <p class="confirm">Password changed</p>            <form action="." method="POST">                <h4>Update your password</h4>                <fieldset>                    <legend>To update your password enter your new and confirmed password below and click the 'Save' button.</legend>                    <div class="input first">                        <label for="password">New password</label>                        <input type="password" name="password" id="password" class="required" value="" />                    </div>                    <div class="input last">                        <label for="confirmPassword">Confirm password</label>                        <input type="password" name="confirmPassword" id="confirmPassword" class="required" value="" />                    </div>                    <button class="Button Btn" type="submit">Save</button>                </fieldset>            </form>        </div>        <div class="sideBar">            #portlets("profileSecondary")        </div>        <div id="changeOrgModal" class="Modal">         </div>                <script type="text/javascript" src="/static/js/jquery.fileupload.js"></script>        <script type="text/javascript" src="/theme/apps/signup/register.js"></script>        <script type="text/javascript" src="/static/js/jquery.milton-upload.js"></script>        <script type="text/javascript" src="/static/js/bs-modals.js"></script>        <script type="text/javascript">            $(function() {                initBootstrapStyleModals();                $("form").forms({                    callback: function(resp, form) {                        confirmMessage = form.closest("div").find("p.confirm");                        log("done", confirmMessage);                        confirmMessage.show(500, function() {                            confirmMessage.hide(5000);                        })                    }                });                $("#myUploaded").mupload({                    url: "/profile/",                    buttonText: "Select a new photo",                    oncomplete: function(data, name, href) {                        jQuery(".profilePic img").attr("src", "/profile/pic");                    }                });                $(document).on("keyup", "#orgTitle", function() {                    typewatch(function() {                        log("do search");                        var query = $("#orgTitle").val();                        doOrgSearch(query);                    }, 500);                });                $(document).on("click", ".orgSearchResults a", function(e) {                    e.preventDefault();                    e.stopPropagation();                    var a = $(e.target);                    log("clicked", a);                    updateOrgId(a.attr("href"));                });                $(document).on("click", "a.membership-remove", function(e) {                    e.preventDefault();                    e.stopPropagation();                    var a = $(e.target).closest("a");                    log("remove", $("form.memberships"));                    if ($("form.memberships li").length === 1) {                        if (!confirm("WARNING: If you delete this membership you will not be able to access this site. Are you sure you want to delete this membership?")) {                            return;                        }                    }                    var li = a.closest("li");                    log("deleteMembership", a);                    deleteMembership(li, a.attr("href"));                });            });            function doOrgSearch(query) {                var url = window.location.pathname + "?changeMemberOrg=" + $("#changeMemberOrg").val() + "&orgSearchQuery=" + query                $("#orgSearchResults").load(url + " .orgSearchResults tbody");            }            function updateOrgId(newId) {                $.ajax({                    type: 'POST',                    url: window.location.pathname,                    data: {                        changeMemberOrg: $("#changeMemberOrg").val(),                        orgId: newId                    },                    dataType: "json",                    success: function(data) {                        alert("Your organisation has been updated.");                        window.location.reload();                    },                    error: function(resp, textStatus, errorThrown) {                        log("error", resp, textStatus, errorThrown);                        alert("Error updating the organisations");                    }                });            }            function deleteMembership(row, id) {                var form = row.closest("form");                form.addClass("ajax-processing");                $.ajax({                    type: 'POST',                    url: window.location.pathname + "?removeMembership=" + id,                    dataType: "json",                    success: function(data) {                        log("success", data);                        form.removeClass("ajax-processing");                        row.remove();                    },                    error: function(resp, textStatus, errorThrown) {                        form.removeClass("ajax-processing");                        log("error", resp, textStatus, errorThrown);                        alert("Error deleting the membership");                    }                });            }        </script>    </body></html>