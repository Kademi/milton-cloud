<html>    <head>        <title>Profile</title>        <link href="profile.css" rel="stylesheet" type="text/css" />    </head>    <body class="profile">        <h3>My Profile</h3>        <div class="row-fluid">            <div class="span6">                <div class="well details">                    <form action="." method="POST" enctype="multipart/form-data" class="profile form-horizontal form-horizontal-narrow">                        <h4>Update your details</h4>                        <p class="pageMessage alert hide"></p>                        <fieldset class="name">                            <legend>Please update your details below then click the 'Save' button.</legend>                            <div class="control-group">                                <label class="control-label" for="nickName">Nickname</label>                                <div class="controls">                                    <input type="text" name="nickName" id="nickName" class="required" value="$!page.profile.nickName"/>                                </div>                            </div>                            <div class="control-group">                                <label class="control-label" for="nickName">Email</label>                                <div class="controls">                                    <input type="text" id="email" name="email" class="required" value="$!page.profile.email" />                                                        </div>                            </div>                            <div class="control-group">                                <label class="control-label" for="nickName">First name</label>                                <div class="controls">                                    <input type="text" id="firstName" name="firstName" value="$!page.profile.firstName" />                                </div>                            </div>                            <div class="control-group">                                <label class="control-label" for="nickName">Surname</label>                                <div class="controls">                                    <input type="text" id="surName" name="surName" value="$!page.profile.surName" />                                </div>                            </div>                            <div class="control-group">                                <label class="control-label" for="nickName">Phone</label>                                <div class="controls">                                    <input type="text" id="phone" name="phone" value="$!page.profile.phone" />                                </div>                            </div>                                  </fieldset>                        <div class="control-group">                            <div class="controls">                                <button class="btn btn-success" type="submit">Save</button>                            </div>                        </div>                                         </form>                            </div>                            </div>            <div class="span6 profilePic">                <div class="well">                    <p class="confirm">Your profile photo has been updated</p>                    <div>                        <img src="$page.photoHref" class="avatar" /><h4>Update photo</h4>                        <p>Update your profile image below. This must be less then 10Mb</p>                    </div>                    <div class="input" id='myUploaded'></div>                </div>                <div class="well">                    <form action="." method="POST" class="form-inline">                        <h4>Update your password</h4>                        <p class="pageMessage alert hide"></p>                        <input type="password" name="password" id="password" class="required input-medium" placeholder="New password">                        <input type="password" name="confirmPassword" id="confirmPassword" class="required input-medium" placeholder="Confirm">                        <button type="submit" class="btn btn-primary">Change</button>                    </form>                </div>                <div class="well">                    <form action="." method="POST" class="form-inline memberships">                        <img class='ajax-loader' src='/static/common/loading.gif'/>                        <h4>Memberships</h4>                        <ul class='list memberships'>                            #foreach($membership in $page.memberships)                            <li>                                Member of the <b>$membership.groupEntity.name</b> group in <b>$membership.withinOrg.formattedName</b>                            <acronym title='Remove this membership. If this is your last membership you will lose access to this site'>                                <a href='$membership.id' class='membership-remove'><i class="icon-remove-circle"></i><span>Remove</span></a>                            </acronym>                            </li>                            #end                        </ul>                    </form>                </div>                #if( $page.optins.size() gt 0 )                <div class="well">                    <form action="." method="POST" class="form-inline optins">                        <img class='ajax-loader' src='/static/common/loading.gif'/>                        <h4>Optional Mailing Lists</h4>                        <ul class='list memberships'>                            #foreach($optin in $page.optins)                            <li>                                #set($id = "optins_" + $optin.optinGroup.name)                                <label for="$id" class="optin">                                    $formatter.checkbox($id, "optins", $user.isInGroup($optin.optinGroup) , $optin.optinGroup.name)                                    $optin.message                                </label>                            </li>                            #end                        </ul>                    </form>                </div>                                #end                <div class="sideBar">                    #portlets("profileSecondary")                </div>            </div>                    </div>        <script type="text/javascript" src="/static/js/jquery.fileupload.js"></script>        <script type="text/javascript" src="/static/js/jquery.milton-upload.js"></script>        <script type="text/javascript">            $(function() {                $("form").forms({                    callback: function(resp, form) {                        log("done");                    }                });                $("#myUploaded").mupload({                    url: "/profile/",                    buttonText: "Select a new photo",                    oncomplete: function(data, name, href) {                        jQuery("img.avatar").attr("src", "/profile/pic");                        showConfirmMessage($("#myUploaded"), "Uploaded");                    }                });                $(".membership-remove").click(function(e) {                    e.preventDefault();                    e.stopPropagation();                    var target = $(e.target).closest("a");                    log("remove", $("form.memberships"));                    if ($("form.memberships li").length === 1) {                        if (!confirm("WARNING: If you delete this membership you will not be able to access this site. Are you sure you want to delete this membership?")) {                            return;                        }                    }                    var li = target.closest("li");                    log("deleteMembership", target);                    deleteMembership(li, target.attr("href"));                });                $("label.optin input").change(function(e) {                    e.preventDefault();                    e.stopPropagation();                    var target = $(e.target);                    updateOptin(target.is(":checked"), target.attr("value"));                });            });            function deleteMembership(row, id) {                var form = row.closest("form");                form.addClass("ajax-processing");                $.ajax({                    type: 'POST',                    url: window.location.pathname + "?removeMembership=" + id,                    dataType: "json",                    success: function(data) {                        log("success", data);                        form.removeClass("ajax-processing");                        row.remove();                    },                    error: function(resp, textStatus, errorThrown) {                form.removeClass("ajax-processing");                        log("error", resp, textStatus, errorThrown);                        alert("Error deleting the membership");                    }                });            }            function updateOptin(on, group) {                var form = $("form.optins");                form.addClass("ajax-processing");                $.ajax({                    type: 'POST',                    url: window.location.pathname,                    data: {                        enableOptin: on,                        group: group                    },                    dataType: "json",                    success: function(data) {                        log("success", data);                        form.removeClass("ajax-processing");                    },                    error: function(resp, textStatus, errorThrown) {                        log("error", resp, textStatus, errorThrown);                        form.removeClass("ajax-processing");                        alert("Error updating the optin");                    }                });            }        </script>    </body></html>